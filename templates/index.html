<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ヘーゼルナッツ異常検知 AI</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesheet.css') }}">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <i class="bi bi-cpu-fill header-icon"></i>
                <h1 class="header-title">ヘーゼルナッツ異常検知 AI</h1>
            </div>
            <div class="header-badge">
                <i class="bi bi-stars"></i>
                <span>AI Powered</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Title Section -->
            <div class="title-section">
                <h2 class="main-title">
                    <span class="gradient-text">AI</span>がヘーゼルナッツの不良品を検知します
                </h2>
                <p class="subtitle">
                    <i class="bi bi-image"></i>
                    画像をアップロードして品質を判定
                </p>
            </div>

            <!-- Upload Card -->
            <div class="upload-card">
                <form method="POST" enctype="multipart/form-data" id="uploadForm">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <i class="bi bi-cloud-upload"></i>
                        </div>
                        <h3 class="upload-title">画像をドラッグ＆ドロップ</h3>
                        <p class="upload-text">または</p>
                        <label for="fileInput" class="file-label">
                            <i class="bi bi-folder2-open"></i>
                            ファイルを選択
                        </label>
                        <input type="file" name="file" id="fileInput" accept="image/*" class="file-input">
                        <p class="upload-hint">PNG, JPG, JPEG, GIF形式に対応</p>
                    </div>

                    <!-- Image Preview -->
                    <div class="preview-container" id="previewContainer" style="display: none;">
                        <div class="preview-header">
                            <h4>プレビュー</h4>
                            <button type="button" class="btn-remove" id="removeBtn">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </div>
                        <img id="imagePreview" src="" alt="プレビュー画像" class="preview-image">
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn-submit" id="submitBtn" disabled>
                        <i class="bi bi-magic"></i>
                        <span>AI判定を実行</span>
                    </button>
                </form>

                <!-- Result Display -->
                {% if answer %}
                <div class="result-container">
                    <div class="result-icon">
                        {% if '良品' in answer %}
                        <i class="bi bi-check-circle-fill success-icon"></i>
                        {% else %}
                        <i class="bi bi-exclamation-triangle-fill warning-icon"></i>
                        {% endif %}
                    </div>
                    <div class="result-text">{{ answer }}</div>
                </div>
                {% endif %}
            </div>

            <!-- Features -->
            <div class="features">
                <div class="feature-card">
                    <i class="bi bi-lightning-charge-fill"></i>
                    <h3>高速処理</h3>
                    <p>瞬時に品質を判定</p>
                </div>
                <div class="feature-card">
                    <i class="bi bi-shield-check"></i>
                    <h3>高精度</h3>
                    <p>AIによる正確な検知</p>
                </div>
                <div class="feature-card">
                    <i class="bi bi-graph-up"></i>
                    <h3>学習済みモデル</h3>
                    <p>最適化された判定</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p class="footer-text">
                <i class="bi bi-code-slash"></i>
                Powered by TensorFlow & Flask
            </p>
            <p class="footer-copyright">&copy; 2024 Hazelnut Anomaly Detection</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const submitBtn = document.getElementById('submitBtn');
        const removeBtn = document.getElementById('removeBtn');

        // Drag and Drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.add('drag-over');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.remove('drag-over');
            });
        });

        uploadArea.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect();
            }
        });

        // File Input Change
        fileInput.addEventListener('change', handleFileSelect);

        function handleFileSelect() {
            const file = fileInput.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    previewContainer.style.display = 'block';
                    submitBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        // Remove Image
        removeBtn.addEventListener('click', () => {
            fileInput.value = '';
            previewContainer.style.display = 'none';
            submitBtn.disabled = true;
        });

        // Form Submit Animation
        document.getElementById('uploadForm').addEventListener('submit', (e) => {
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i><span>処理中...</span>';
            submitBtn.disabled = true;
        });
    </script>
</body>

</html>